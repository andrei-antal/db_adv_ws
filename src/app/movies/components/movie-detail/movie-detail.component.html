<div class="card">
  <div class="card-header">Movie form</div>
  <div class="card-body">
    <div class="row">
      <form class="col-9" [formGroup]="movieForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label for="movieTitle">Title</label>
          <input
            name="title"
            class="form-control"
            id="movieTitle"
            placeholder="Enter title"
            formControlName="title"
          />
          @if(movieForm.controls.title.invalid &&
          movieForm.controls.title.dirty) {
          <div class="invalid-feedback">Title required</div>
          }
        </div>
        <div class="form-group">
          <label for="movieGenre" class="d-block">Genre</label>
          @for (genreCtrl of genreArray.controls; track $index) {
          <div formArrayName="genre" class="mb-2">
            <select
              class="form-select w-50 d-inline me-2"
              [formControlName]="$index"
            >
              <option disabled value="">Choose a new genre</option>
              @for (genre of genres; track genre) {
              <option [ngValue]="genre">
                {{ genre }}
              </option>
              }
            </select>
            <button
              class="btn btn-outline-secondary"
              (click)="removeGenre($index)"
              type="button"
            >
              <i class="fa-regular fa-circle-xmark"></i>
            </button>
          </div>
          }
          <button
            class="btn btn-dark btn-sm"
            (click)="addGenre()"
            type="button"
          >
            Add genre
          </button>
          @if (movieForm.controls.genre.errors?.['required'] &&
          movieForm.controls.genre.dirty) {
          <div class="invalid-feedback">Genre required</div>
          } @else if (movieForm.controls.genre.errors?.['wrongGenre'] &&
          movieForm.controls.genre.dirty) {
          <div class="invalid-feedback">Not a genre category</div>
          }
        </div>
        <div class="form-group">
          <label for="movieYear">Year</label>
          <input
            name="year"
            class="form-control"
            id="movieYear"
            placeholder="Enter year"
            formControlName="year"
          />
          @if (movieForm.controls.year.invalid && movieForm.controls.year.dirty)
          {
          <div class="invalid-feedback">Year required</div>
          }
        </div>
        <div class="form-group">
          <label for="moviePlot">Plot</label>
          <input
            name="plot"
            class="form-control"
            id="moviePlot"
            placeholder="Enter plot"
            formControlName="plot"
          />
          @if (movieForm.controls.plot.invalid && movieForm.controls.plot.dirty)
          {
          <div class="invalid-feedback">Plot required</div>
          }
        </div>
        <div class="form-group">
          <label for="moviePoster">Poster</label>
          <input
            name="poster"
            class="form-control"
            id="moviePoster"
            placeholder="Enter poster"
            formControlName="poster"
          />
        </div>
        <div class="my-2">
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="movieForm.invalid"
          >
            Save
          </button>
          <a [routerLink]="['/movies']" class="btn btn-outline-secondary mx-2"
            >Cancel</a
          >
        </div>
        @if (movieForm.errors?.['wrongSciFiYear'] && movieForm.dirty) {
        <div class="invalid-feedback">
          Sci-Fi movies were introduced after 1902
        </div>
        }
      </form>
      <div class="col-3">
        <img
          ngmMovieImageFallback="assets/noImage2.png"
          class="w-100"
          [src]="movieForm.controls.poster.value"
        />
      </div>
    </div>
  </div>
</div>
